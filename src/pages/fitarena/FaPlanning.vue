<template>
  <div class="fa-planning">
    <PlanningNavigation
      :calendar-api="calendarApi"
      :current-date-start="currentDateStart"
      :current-date-end="currentDateEnd"
      :current-week="currentWeek"
      @filter-updated="planningStore.applyFilter"
    />
    <modalCreneau
      v-if="isModalCreneauOpen"
      :is-open="isModalCreneauOpen"
      :type-action="actionType"
      @close-modal-creneau="isModalCreneauOpen = false"
    />
    <FullCalendar ref="fullCalendar" :options="calendarOptions">
      <template #eventContent="arg">
        <div class="flex h-full items-center">
          <div class="h-full w-2 rounded-l-xl bg-red-600"></div>
          <div class="flex grow justify-between px-3 pr-3 text-xs text-black">
            <div class="flex flex-col">
              <span>
                {{ $dayjs(arg.event.start).format('H:mm') }} -
                {{ $dayjs(arg.event.end).format('H:mm') }}
              </span>
              <span class="">{{ arg.event.title }}</span>
            </div>
            <div class="flex">
              <span
                v-if="arg.event.extendedProps.activites"
                class="mr-2 fill-red-600"
                v-html="ICON[arg.event.extendedProps.activites[0].libelle]"
              ></span>
              <span
                class="text-2xs border-3 flex h-8 w-8 items-center justify-center rounded-full border-red-600 bg-white text-center leading-none"
              >
                Terrain<br />
                1/3
              </span>
            </div>
          </div>
        </div>
      </template>
    </FullCalendar>
  </div>
</template>

<script>
import PlanningNavigation from '@components/faPlanning/navigation.vue' // PlanningNavigation as navigation is an html reserved tag
import modalCreneau from '@components/faPlanning/modalCreneau.vue'
import FullCalendar from '@fullcalendar/vue3'
import dayGridPlugin from '@fullcalendar/daygrid'
import timeGridPlugin from '@fullcalendar/timegrid'
import resourceTimeGridPlugin from '@fullcalendar/resource-timegrid'
import interactionPlugin from '@fullcalendar/interaction'
import frLocale from '@fullcalendar/core/locales/fr'
import { getActivites } from '@api/activite.js'
import { usePlanningStore } from '@stores/planning.js'
import { useCreneauStore } from '@stores/creneau.js'
import { mapStores } from 'pinia'

export default {
  components: {
    PlanningNavigation,
    modalCreneau,
    FullCalendar,
  },
  data() {
    return {
      calendarOptions: {
        plugins: [
          dayGridPlugin,
          timeGridPlugin,
          resourceTimeGridPlugin,
          interactionPlugin,
        ],
        headerToolbar: false,
        initialView: 'timeGridWeek',
        locale: frLocale,
        editable: true,
        selectable: true,
        selectMirror: true,
        dayMaxEvents: true,
        slotEventOverlap: true,
        weekends: true,
        datesSet: this.refreshDates,
        eventClick: this.eventClick,
        eventResize: this.eventResizeOrDrag,
        eventDrop: this.eventResizeOrDrag,
        select: this.select,
        dayHeaderFormat: { weekday: 'long', day: 'numeric', month: 'long' },
        nowIndicator: true,
        eventDisplay: 'block',
        events: [],
        resources: [],
        allDaySlot: false,
        eventOverlap: false,
        selectOverlap: false,
        height: 'auto',
        schedulerLicenseKey: 'CC-Attribution-NonCommercial-NoDerivatives',
        // timeZone: 'UTC', // TODO dayjs UTC local: https://dayjs.gitee.io/docs/en/parse/unix-timestamp
        slotLabelFormat: {
          hour: 'numeric',
          minute: '2-digit',
        },
      },
      calendarApi: {},
      isModalCreneauOpen: false,
      currentDateStart: '',
      currentDateEnd: '',
      currentWeek: '',
      actionType: '',
      ICON: {
        Football:
          '<svg width="30" height="30" xmlns="http://www.w3.org/2000/svg"><path d="M14.58 29.994a15.004 15.004 0 0 1-11.319-5.658A14.991 14.991 0 0 1 .085 13.415 15.001 15.001 0 0 1 11.425.435a14.91 14.91 0 0 1 4.99-.365 15.06 15.06 0 0 1 4.765 1.266c.263.118.84.408 1.085.545a14.992 14.992 0 0 1 3.991 3.209 15.007 15.007 0 0 1 3.588 12.055A15.008 15.008 0 0 1 17.94 29.709l-.242.045c-.573.108-1.23.185-1.928.226-.176.01-1.012.02-1.19.014zm.8-1.274a13.413 13.413 0 0 0 2.136-.23c.015-.006.064-.107.194-.402a995.498 995.498 0 0 0 2.252-5.128c.001-.008-.441-.608-.982-1.333l-.984-1.317-3.35.002-3.35.003-.988 1.32a76.447 76.447 0 0 0-.985 1.332c.001.007.53 1.214 1.177 2.683l1.175 2.67.165.04a13.606 13.606 0 0 0 3.54.36zm4.41-.86a13.768 13.768 0 0 0 5.935-4.305c.093-.116.345-.449.342-.451l-.592.077-2.515.335c-1.059.14-1.928.259-1.932.262-.004.005-1.859 4.211-1.895 4.3-.005.013.395-.12.657-.218zm-9.773-.082c-.012-.03-1.76-4.003-1.761-4.005a6193.528 6193.528 0 0 1-3.9-.521 11.336 11.336 0 0 0-.364-.046c-.002.001.046.067.107.146a13.733 13.733 0 0 0 5.611 4.317c.31.128.316.13.307.108zm-.777-6.883c.628-.842 1.15-1.538 1.159-1.548.016-.017.022-.014.116.057.055.041.101.072.102.068.003-.007-1.823-5.631-1.83-5.638a20813.433 20813.433 0 0 1-2.726-1.118c-.548-.225-.554-.227-.575-.208l-.451.398-3.203 2.832c-.407.36-.512.458-.512.477a13.659 13.659 0 0 0 1.37 4.87c.13.264.339.658.358.677.004.004.333.05.732.103l2.515.334c.985.13 1.793.235 1.796.232.004-.003.52-.695 1.149-1.536Zm14.77 1.17c1.47-.195 2.675-.353 2.678-.35.002.002.015.087.03.19l.025.186.082-.139a13.751 13.751 0 0 0 1.86-6.03 9.126 9.126 0 0 0-.224.249c-.196.22-.224.249-.239.237-.015-.012-4.006-3.538-4.296-3.796a.662.662 0 0 0-.155-.119c-.018.005-3.274 1.338-3.28 1.342-.004.005-1.841 5.658-1.838 5.661.001.001.053-.036.116-.083a.464.464 0 0 1 .12-.076c.005.004.529.704 1.164 1.554l1.156 1.546.063-.009 2.737-.363zm-5.704-5.715c.475-1.46.863-2.662.863-2.67 0-.008-.131-.11-.292-.226l-1.487-1.08a27531.465 27531.465 0 0 0-2.722-1.977l-.027-.02-.268.195a745.59 745.59 0 0 0-4.267 3.107c.004.018 1.727 5.317 1.73 5.324.003.004 1.266.006 2.806.005l2.802-.003Zm10.405-1.715a13.755 13.755 0 0 0-1.103-5.04c-.12-.277-.181-.408-.344-.735a13.31 13.31 0 0 0-1.042-1.75c-.166-.236-.437-.591-.441-.578-.003.007-.221 1.163-.486 2.568l-.482 2.555.04.04a5638.718 5638.718 0 0 1 3.326 2.943l.536.474.003-.064a10.9 10.9 0 0 0-.007-.413zm-25.806-1.58c.858-.758 1.562-1.38 1.564-1.38.004-.004-.806-4.325-.818-4.364-.006-.021-.021-.002-.127.16a13.755 13.755 0 0 0-2.244 6.953v.07l.033-.03c.017-.018.734-.651 1.592-1.41zm7.23-1.01 2.258-1.64 1.446-1.05V7.239l.001-2.117-2.238-1.31A248.207 248.207 0 0 0 9.349 2.5c-.02 0-.293.129-.558.263a13.674 13.674 0 0 0-2.726 1.822 14.97 14.97 0 0 0-1.318 1.291l-.037.042.495 2.623.498 2.625a1590.838 1590.838 0 0 0 3.367 1.38c.124.051.232.092.24.09.008-.002.38-.268.826-.592zm10.939.148 1.8-.737.71-.291.528-2.799c.29-1.54.53-2.8.532-2.803.002-.003.086.01.185.03.1.018.181.032.181.03 0-.014-.364-.382-.554-.56-.35-.331-.558-.514-.876-.769a13.788 13.788 0 0 0-3.402-2.003.486.486 0 0 0-.098-.034c0 .003.013.029.03.057l.03.052-2.343 1.374L15.3 5.205l-.155.092-.002 1.919-.002 1.919 2.412 1.752c1.327.964 2.416 1.752 2.42 1.753.006 0 .5-.201 1.1-.447zM16.629 2.92a137.503 137.503 0 0 0 1.963-1.162 13.48 13.48 0 0 0-3.266-.477 13.662 13.662 0 0 0-4.126.533c-.247.071-.285.084-.277.092.022.022 3.706 2.173 3.719 2.171.009-.001.903-.522 1.987-1.157Z"/></svg>',
        Volley:
          '<svg width="25" height="25" xmlns="http://www.w3.org/2000/svg"><path style="fill:#000;stroke-width:.00555556" d="M12.19 24.994a12.48 12.48 0 0 1-5.276-1.315A12.488 12.488 0 0 1 .028 11.694 12.5 12.5 0 0 1 14.064.1a12.496 12.496 0 0 1 9.275 18.622A12.502 12.502 0 0 1 12.98 24.99c-.215.008-.6.01-.79.005zm.907-1.007c.196-.012.331-.022.525-.04.15-.014.154-.015.18-.032a8.65 8.65 0 0 1 .148-.084 9.489 9.489 0 0 0 1.718-1.244c1.44-1.298 2.689-3.137 3.691-5.434a25.23 25.23 0 0 0 1.293-3.78c.06-.236.146-.6.142-.603a15.708 15.708 0 0 0-2.992-.45c-.01-.003-.013 0-.016.01l-.028.145c-.198 1.034-.573 2.227-1.061 3.37-.251.588-.56 1.221-.873 1.788a20.318 20.318 0 0 1-4.252 5.317 20.57 20.57 0 0 1-.893.756c-.083.065-.15.12-.15.122-.002.007.34.06.554.086.348.043.593.062 1.061.083.122.005.81-.002.953-.01zm-3.596-.63a20.12 20.12 0 0 0 2.849-2.58 18.984 18.984 0 0 0 3.593-5.719c.316-.787.57-1.589.748-2.352.027-.117.087-.396.087-.406 0-.007-.139-.005-.47.006a18.411 18.411 0 0 0-3.362.435l-.035.128a18.48 18.48 0 0 1-.68 2.034 18.625 18.625 0 0 1-1.839 3.516c-.956 1.42-2.058 2.577-3.3 3.464-.126.09-.416.284-.535.358a.637.637 0 0 0-.08.054c0 .006.224.139.379.226a11.562 11.562 0 0 0 2.4 1.012c.006 0 .116-.08.245-.176zm7.04-.09c.818-.307 1.585-.699 2.312-1.18.531-.354.965-.694 1.452-1.14.134-.122.522-.51.643-.642.445-.487.79-.926 1.138-1.452a11.479 11.479 0 0 0 1.834-4.984l.003-.027-.04.06a4.66 4.66 0 0 1-.041.064c-.001 0-.025-.013-.053-.03-.4-.242-1.064-.545-1.7-.773a5.643 5.643 0 0 0-.332-.11c-.002 0-.02.079-.043.173a25.904 25.904 0 0 1-1.599 4.68c-.213.469-.47.982-.708 1.416-.852 1.555-1.852 2.877-2.932 3.878-.06.057-.122.113-.136.126l-.025.024.07-.024.158-.058zM5.653 21.622a10.48 10.48 0 0 0 1.87-1.366c.134-.12.15-.138.14-.145a34.216 34.216 0 0 0-.11-.066c-1.914-1.176-3.47-3.126-4.596-5.76a14.081 14.081 0 0 1-.387-.993A.502.502 0 0 1 3 12.69a.502.502 0 0 1 .41.145c.069.073.083.1.163.313.848 2.25 1.991 4.012 3.394 5.231.413.36.862.68 1.318.942l.105.06.012-.014.087-.1c.467-.531.949-1.183 1.354-1.83.173-.278.32-.527.315-.536a16.494 16.494 0 0 1-2.027-1.923A16.38 16.38 0 0 1 4.327 7.37a.994.994 0 0 1-.034-.233c0-.224.14-.411.36-.479a.353.353 0 0 1 .136-.015c.077 0 .09.002.135.015a.5.5 0 0 1 .325.29c.01.025.027.09.045.178a15.363 15.363 0 0 0 4.867 8.473c.13.115.454.39.477.404.009.006.132-.241.277-.558a18.493 18.493 0 0 0 1.021-2.79c.003-.017 0-.023-.067-.099a19.057 19.057 0 0 1-2.31-3.247 19.15 19.15 0 0 1-.685-1.352c-.843-1.85-1.363-3.887-1.455-5.7l-.004-.073-.162.083a11.161 11.161 0 0 0-1.29.77c-.484.34-.843.627-1.268 1.016-.135.124-.522.51-.648.648a11.497 11.497 0 0 0-3.013 8.694 11.495 11.495 0 0 0 4.526 8.278l.092-.05zm18.345-8.808c.006-.12 0-.723-.008-.857a11.61 11.61 0 0 0-.317-2.186l-.172-.087C21.737 8.803 19.632 8.2 17.62 8c-.61-.06-1.085-.081-1.725-.076a14.863 14.863 0 0 0-3.612.466c-.171.044-.176.045-.244.045a.495.495 0 0 1-.416-.219.499.499 0 0 1 .3-.762c.325-.088.793-.194 1.163-.262a16.26 16.26 0 0 1 3.925-.24c2.083.122 4.216.635 6.186 1.489l.073.03a11.573 11.573 0 0 0-1.49-2.763c-.013-.021-.018-.025-.035-.025-.05 0-.125-.023-.287-.088-1.937-.775-4.09-1.307-5.997-1.48A14.72 14.72 0 0 0 14 4.047c-.369 0-.521.004-.822.022-.86.05-1.684.188-2.435.406-.24.07-.22.065-.307.065a.497.497 0 0 1-.364-.831c.081-.087.142-.119.328-.173.863-.252 1.728-.4 2.675-.459.313-.02.426-.023.797-.026.447-.004.76.004 1.19.032 1.637.104 3.42.455 5.2 1.024.08.026.147.046.148.045a11.518 11.518 0 0 0-7.524-3.148c-.198-.007-.76-.004-.933.006a11.548 11.548 0 0 0-3.525.732l-.024.009.003.206c.015.886.185 2.004.466 3.053.627 2.344 1.782 4.542 3.42 6.506.185.222.246.291.256.29a18.903 18.903 0 0 1 5.415-.476c1.967.117 3.89.578 5.51 1.32.068.031.21.1.318.155l.198.099a.594.594 0 0 0 .007-.093z"/></svg>',
        Basket:
          '<svg width="26" height="26" xmlns="http://www.w3.org/2000/svg"><path style="fill:#000;stroke-width:.0065001" d="M12.704 25.76a12.643 12.643 0 0 1-10.609-6.484 12.634 12.634 0 0 1-1.562-5.242c-.024-.345-.029-.487-.029-.897a12.632 12.632 0 1 1 12.2 12.623zm1.086-1.01a11.646 11.646 0 0 0 3.664-.816.5.5 0 0 0-.04-.1c-.685-1.453-.98-2.96-.864-4.402a7.537 7.537 0 0 1 1.103-3.373c.211-.336.427-.6.796-.977l.142-.144-.044-.074a18.482 18.482 0 0 0-1.12-1.646c-.211-.277-.582-.734-.592-.73a6.732 6.732 0 0 0-.17.187 28.104 28.104 0 0 1-3.145 3.004c-2.346 1.933-5.265 3.773-8.598 5.42-.097.048-.177.09-.177.093a11.613 11.613 0 0 0 3.523 2.509 11.652 11.652 0 0 0 4.466 1.06c.123.007.906-.002 1.056-.011zm4.73-1.305a11.732 11.732 0 0 0 2.432-1.696l.038-.035-.02-.137a18.332 18.332 0 0 0-1.718-5.43l-.15-.3-.026.024c-.037.036-.18.193-.264.292-.352.407-.704 1.064-.933 1.738a6.633 6.633 0 0 0-.349 1.846c-.008.17-.005.598.007.758.06.835.25 1.632.583 2.453.095.235.244.56.256.56.004 0 .069-.033.145-.073zm3.406-2.692a11.657 11.657 0 0 0 2.804-6.672c.001-.018 0-.035-.002-.037a4.236 4.236 0 0 0-.306-.062 6.432 6.432 0 0 0-.495-.062 7.958 7.958 0 0 0-.757-.01 5.744 5.744 0 0 0-2.633.789 6.777 6.777 0 0 0-.665.45c-.006.005.004.029.05.117a19.295 19.295 0 0 1 1.936 5.56.894.894 0 0 0 .068-.073zm-17.447-.549c2.897-1.432 5.475-3.011 7.618-4.668 1.935-1.497 3.567-3.097 4.804-4.71 1.189-1.55 2.043-3.12 2.537-4.665.272-.85.439-1.752.44-2.373v-.135l-.037-.026a11.655 11.655 0 0 0-5.092-2.014c-.251-.036-.287-.04-.283-.028a9.214 9.214 0 0 1 .324 3.67 9.153 9.153 0 0 1-.854 2.95 2.61 2.61 0 0 0-.077.17l.12.088c.56.414 1.232.968 1.763 1.453.007.006-.055.077-.311.358l-.337.369-.018.018-.109-.097c-.465-.42-.958-.827-1.469-1.212-.15-.113-.19-.14-.196-.134l-.085.1a9.221 9.221 0 0 1-1.22 1.174c-1.24.993-2.644 1.607-4.132 1.806-1.237.166-2.538.043-3.845-.364-.48-.15-.92-.318-1.417-.543a19.164 19.164 0 0 1-.893-.445.16.16 0 0 0-.013.047c-.14.795-.195 1.398-.195 2.14a11.634 11.634 0 0 0 2.53 7.246c.024.03.025.03.045.022l.402-.197zm14.923-5.951a6.777 6.777 0 0 1 5.344-1.228l.022.003-.005-.19a11.628 11.628 0 0 0-3.878-8.38c-.029-.027-.043-.036-.046-.03a9.98 9.98 0 0 1-.081.554c-.332 1.895-1.241 3.922-2.638 5.876-.18.253-.474.643-.597.795-.034.042-.038.049-.03.059l.116.137a19.63 19.63 0 0 1 1.754 2.431.412.412 0 0 0 .039-.027zM7.267 11.356c.302-.025.472-.045.69-.082 1.378-.23 2.667-.87 3.792-1.881.145-.13.411-.394.543-.537.24-.262.443-.518.528-.668a8.198 8.198 0 0 0 1.02-3.528c.01-.16.01-.727 0-.893a8.244 8.244 0 0 0-.412-2.148l-.04-.12-.368.004a9.042 9.042 0 0 0-.78.031 11.644 11.644 0 0 0-6.587 2.69.567.567 0 0 0-.09.085c.002.003.088.03.19.059a25.96 25.96 0 0 1 5.992 2.61c.007.007-.036.082-.243.43-.138.232-.253.424-.256.426a.494.494 0 0 1-.099-.05A24.925 24.925 0 0 0 4.878 5.16l-.175-.047-.023.026-.104.113a11.622 11.622 0 0 0-2.625 4.682l.126.07c.841.468 1.662.815 2.467 1.042a8.516 8.516 0 0 0 1.842.315c.126.007.775.003.881-.006z"/></svg>',
        Badminton:
          '<svg width="27" height="27" xmlns="http://www.w3.org/2000/svg"><path style="fill:#000;stroke-width:.00675011" d="M22.95 26.53a3.266 3.266 0 0 1-1.876-.751 43.66 43.66 0 0 1-1.148-1.138c0-.003-.288-.294-.64-.646-.588-.589-.642-.641-.682-.66a.676.676 0 0 1-.085-.05c-.038-.027-.126-.057-1.33-.453l-1.367-.449-6.557-2.156c-4.791-1.576-6.495-2.138-6.535-2.16a.54.54 0 0 1-.19-.183l-1.012-1.886C.88 14.788.537 14.138.523 14.1a.338.338 0 0 1-.02-.155c0-.088.002-.104.019-.152a.512.512 0 0 1 .288-.31c.024-.009.73-.214 1.57-.457.838-.242 1.527-.442 1.53-.445.003-.002-.073-.874-.17-1.938-.191-2.111-.181-1.975-.146-2.082a.508.508 0 0 1 .344-.323c.025-.007.82-.082 1.975-.187l1.936-.178.177-1.928c.096-1.06.177-1.937.179-1.95a.542.542 0 0 1 .116-.243.513.513 0 0 1 .367-.169c.027 0 .902.078 1.943.172 1.042.095 1.903.173 1.914.172h.02l.446-1.543c.245-.85.452-1.56.46-1.58a.505.505 0 0 1 .524-.3c.083.012.125.03.335.143l1.864.996c.915.489 1.68.9 1.7.914a.515.515 0 0 1 .18.216c.009.02 1.168 3.544 2.578 7.83l2.62 7.967c.048.147.058.186.065.248l.008.075.767.815c.567.602.848.895 1.078 1.123.304.302.396.401.506.547.326.43.545.95.623 1.479.027.188.03.234.03.484 0 .194-.003.268-.012.347a3.28 3.28 0 0 1-.699 1.686 3.95 3.95 0 0 1-.445.446 3.26 3.26 0 0 1-1.8.707 5.648 5.648 0 0 1-.443.002zm.412-1.002c.657-.06 1.259-.408 1.606-.927.215-.32.341-.671.378-1.049a2.246 2.246 0 0 0-.728-1.88l-.156-.156-1.564 1.564-1.564 1.564.165.164c.25.25.407.367.65.489.26.13.542.21.832.234.066.006.31.004.381-.003zm.379-4.754-.52-.554c-.273-.29-.498-.528-.502-.53-.004 0-.717.709-1.585 1.577l-1.579 1.579.542.541.541.542 1.565-1.564 1.564-1.564zm-4.692 1.162c-.007-.007-4.498-2.59-4.502-2.59-.002 0-.269.265-.593.589l-.589.589 2.672.878 2.67.88.173-.172c.094-.094.17-.173.169-.174zm.914-.91.176-.175-1.775-1.775-1.776-1.775-.654.655c-.511.51-.653.656-.645.66.09.055 4.487 2.585 4.492 2.586.004 0 .086-.079.182-.175zm-6.99-1.528c.37-.37.67-.673.668-.675-.013-.013-9.256-5.33-9.266-5.33-.007 0-.1.026-.207.057a470.775 470.775 0 0 1-1.731.5c-.6.174-.703.204-.704.207-.001.002.354.668.79 1.481l.79 1.478.144.049 1.285.423 4.34 1.428c1.76.579 3.204 1.053 3.21 1.053.006 0 .312-.302.681-.671zm8.205.295a4152.473 4152.473 0 0 1-2.586-4.49c-.002-.002-.293.287-.649.643l-.646.646 1.775 1.775 1.776 1.775.168-.168c.145-.145.168-.17.162-.181zm.917-.898.175-.175-.818-2.487-.879-2.671-.06-.185-.594.593c-.326.326-.593.596-.593.599 0 .008 2.587 4.5 2.591 4.5.002 0 .082-.078.178-.174zM15.13 17.34l.75-.75-3.87-3.869-3.87-3.87-1.762.16c-.97.089-1.764.162-1.766.164-.003.004.31 3.466.316 3.473.001.003 1.002.58 2.224 1.284l4.718 2.717c1.374.791 2.5 1.44 2.504 1.44.004 0 .344-.337.756-.749zm.224-7.662-2.724-4.73c-.004-.006-.465-.05-1.742-.167a527.82 527.82 0 0 0-1.739-.156l-.16 1.75-.159 1.748 3.88 3.88 3.878 3.879.742-.742.742-.742zm4.131 3.307.677-.677-1.48-4.496-1.478-4.496-1.48-.792a190.63 190.63 0 0 0-1.485-.789c-.003.004-.766 2.646-.768 2.659 0 .01 5.327 9.267 5.334 9.267.002 0 .308-.304.68-.676z"/></svg>',
        Bike: '<svg width="27" height="15.998" xmlns="http://www.w3.org/2000/svg"><path style="fill:#000;stroke-width:.00675011" d="M5.636 15.113A5.09 5.09 0 0 1 .932 10.79a4.626 4.626 0 0 1-.052-.84 5.061 5.061 0 0 1 1.346-3.351 5.001 5.001 0 0 1 3.053-1.573c.35-.044.812-.05 1.167-.014a5.095 5.095 0 0 1 2.246.777l.095.061.664-.856c.365-.47.664-.862.664-.869 0-.007-.264-.56-.587-1.231l-.587-1.22h-.48c-.394 0-.487-.002-.526-.01-.205-.043-.328-.24-.284-.456a.34.34 0 0 1 .101-.192A.34.34 0 0 1 7.92.92c.04-.011.154-.012 1.872-.012h1.83l.052.019a.36.36 0 0 1 .252.337c.012.2-.105.36-.291.4-.04.008-.181.01-.944.01-.492 0-.896.002-.896.005s.217.443.482.977l.482.972 3.646.002 3.645.002-.056-.137-.462-1.127c-.25-.608-.41-1.007-.416-1.036a.382.382 0 0 1 .021-.24c.035-.076.159-.17.26-.197A45.65 45.65 0 0 1 19.282.89c.338.045.605.168.746.343.1.124.14.24.141.405 0 .274-.155.572-.464.885-.097.099-.132.124-.21.15a.38.38 0 0 1-.437-.559c.011-.02.056-.073.099-.118.098-.104.137-.15.185-.217l.039-.054-.03-.009c-.104-.03-.107-.03-.727-.033-.564-.003-.59-.002-.586.01l.72 1.76.72 1.756c.003.006.011.005.032-.002a5.16 5.16 0 0 1 1.166-.233c.144-.014.633-.012.796.003a5.081 5.081 0 0 1 3.432 1.764 5.084 5.084 0 0 1 1.161 2.527c.044.288.055.437.054.776 0 .281-.004.364-.027.57a5.09 5.09 0 0 1-4.529 4.482c-.367.037-.804.03-1.164-.016a5.127 5.127 0 0 1-3.542-2.16 5.044 5.044 0 0 1-.855-3.578 4.992 4.992 0 0 1 .66-1.866 5.218 5.218 0 0 1 1.987-1.9c.08-.043.102-.059.1-.067a62.67 62.67 0 0 0-.343-.828c-.004 0 .006-.012-1.483 1.745a8515.723 8515.723 0 0 1-2.139 2.524.269.269 0 0 0 .036.055c.272.361.391.86.316 1.316-.048.295-.18.59-.372.83-.06.076-.192.209-.268.27a2.094 2.094 0 0 1-.336.216 1.705 1.705 0 0 1-.795.184c-.29 0-.545-.06-.796-.184a1.732 1.732 0 0 1-.679-.597 1.771 1.771 0 0 1-.252-.564l-.012-.05h-.613l-.009.094a5.071 5.071 0 0 1-.766 2.248c-.214.334-.411.58-.696.864a4.792 4.792 0 0 1-.895.717 5.064 5.064 0 0 1-2.261.755 8.48 8.48 0 0 1-.75.01zm.534-.77a4.303 4.303 0 0 0 3.986-3.36 5.04 5.04 0 0 0 .084-.545v-.016H6.676l-.024.039a.812.812 0 0 1-.48.35.966.966 0 0 1-.314.016.823.823 0 0 1-.674-.661.935.935 0 0 1 .003-.272.83.83 0 0 1 .55-.619.723.723 0 0 1 .27-.037h.11L7.22 7.835 8.323 6.43l-.086-.056a4.075 4.075 0 0 0-2.175-.648c-.507-.01-.977.061-1.448.217a4.365 4.365 0 0 0-2.106 1.52 4.295 4.295 0 0 0-.82 1.97 3.338 3.338 0 0 0-.037.604c0 .3.005.378.04.627a4.333 4.333 0 0 0 2.204 3.161 4.28 4.28 0 0 0 2.275.519zm15.255-.01a4.312 4.312 0 0 0 3.913-3.877 6.156 6.156 0 0 0 0-.783 4.342 4.342 0 0 0-.242-1.071 4.364 4.364 0 0 0-3.367-2.793 4.515 4.515 0 0 0-1.678.047c-.11.025-.269.067-.283.076-.007.004.15.395.666 1.656l.676 1.652.048.008c.242.04.47.213.587.443.086.171.104.36.054.549a.83.83 0 0 1-.493.543.707.707 0 0 1-.306.049.67.67 0 0 1-.315-.075.804.804 0 0 1-.462-.722c0-.174.052-.337.15-.467a.257.257 0 0 0 .033-.052c0-.007-1.343-3.293-1.348-3.298a3.953 3.953 0 0 0-.335.193 4.462 4.462 0 0 0-1.201 1.14 4.258 4.258 0 0 0-.717 3.323 4.352 4.352 0 0 0 3.493 3.409c.192.033.31.046.573.064.081.005.443-.003.554-.013zm-7.84-3.296a.966.966 0 0 0 .256-.088 1.02 1.02 0 0 0 .551-.703.75.75 0 0 0 .016-.202.76.76 0 0 0-.016-.202.998.998 0 0 0-.28-.51 1.015 1.015 0 0 0-.544-.29 1.16 1.16 0 0 0-.365.002 1.049 1.049 0 0 0-.691.495.989.989 0 0 0-.088.807 1.035 1.035 0 0 0 .877.707c.05.007.219-.003.284-.016zm-1.945-1.41c.043-.175.136-.385.244-.55.087-.131.216-.277.343-.388l.047-.04-.895-1.855c-.491-1.02-.897-1.854-.9-1.855-.005 0-.854 1.074-1.066 1.35l-.038.048.133.13c.55.541.942 1.144 1.207 1.857.143.384.251.86.288 1.263l.009.093h.615l.013-.053zm-1.41-.047a4.289 4.289 0 0 0-1.272-2.624c-.055-.053-.056-.054-.067-.04-.119.149-2.125 2.705-2.126 2.71-.002.004.625.006 1.734.006h1.736zm5.18-2.516 1.682-1.978.505-.594-3.224-.001h-3.226c-.002.002 1.826 3.79 1.838 3.81.004.007.014.006.046-.001.274-.064.612-.051.894.034.082.025.2.071.255.1a.12.12 0 0 0 .042.015c.005 0 .54-.624 1.187-1.385z"/></svg>',
        Hourglass:
          '<svg width="14" height="18" viewBox="0 0 14 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.4125 16.65H10.5875V13.7925C10.5875 12.7425 10.2411 11.8387 9.54844 11.0812C8.85573 10.3237 8.00625 9.945 7 9.945C5.99375 9.945 5.14427 10.3237 4.45156 11.0812C3.75885 11.8387 3.4125 12.7425 3.4125 13.7925V16.65ZM7 8.055C8.00625 8.055 8.85573 7.67625 9.54844 6.91875C10.2411 6.16125 10.5875 5.25 10.5875 4.185V1.35H3.4125V4.185C3.4125 5.25 3.75885 6.16125 4.45156 6.91875C5.14427 7.67625 5.99375 8.055 7 8.055ZM0 18V16.65H2.1V13.7925C2.1 12.7425 2.36615 11.7787 2.89844 10.9012C3.43073 10.0238 4.17083 9.39 5.11875 9C4.17083 8.61 3.43073 7.9725 2.89844 7.0875C2.36615 6.2025 2.1 5.235 2.1 4.185V1.35H0V0H14V1.35H11.9V4.185C11.9 5.235 11.6339 6.2025 11.1016 7.0875C10.5693 7.9725 9.82917 8.61 8.88125 9C9.82917 9.39 10.5693 10.0238 11.1016 10.9012C11.6339 11.7787 11.9 12.7425 11.9 13.7925V16.65H14V18H0Z" fill="#3586E2"/></svg>',
      },
    }
  },
  computed: {
    ...mapStores(usePlanningStore),
    ...mapStores(useCreneauStore),
  },
  async mounted() {
    this.calendarApi = this.$refs.fullCalendar.getApi()
    this.setRessources()
    await this.planningStore.fetch()
    this.calendarOptions.events = this.planningStore.creneaux
    this.calendarOptions.slotMinTime = this.planningStore.slotMinTime
    this.calendarOptions.slotMaxTime = this.planningStore.slotMaxTime
  },
  methods: {
    async setRessources() {
      const activites = await getActivites(this.$route.params.id)
      // do not use map with vue3 var (type Proxy), it wont work, use forEach instead
      activites.forEach(function (activite) {
        activite.title = activite.libelle
      })
      this.calendarOptions.resources = activites
    },
    refreshDates(dateInfo) {
      this.currentWeek = this.getWeekNumber(dateInfo.start)
      this.currentDateStart = this.$dayjs(dateInfo.start).format('D MMMM')
      this.currentDateEnd = this.$dayjs(dateInfo.end - 1).format('D MMMM YYYY')
    },
    getWeekNumber: function (date) {
      var d = new Date(date)
      d.setHours(0, 0, 0, 0)
      d.setDate(d.getDate() + 3 - ((d.getDay() + 6) % 7))
      var week1 = new Date(d.getFullYear(), 0, 4)
      return (
        1 +
        Math.round(
          ((d.getTime() - week1.getTime()) / 86400000 -
            3 +
            ((week1.getDay() + 6) % 7)) /
            7
        )
      )
    },
    eventClick(eventClickInfo) {
      this.creneauStore.setSelectedCreneau(eventClickInfo.event)
      this.actionType = 'edit'
      this.isModalCreneauOpen = true
    },
    select(selectionInfo) {
      this.creneauStore.setSelectedCreneau(selectionInfo)
      this.actionType = 'create'
      this.isModalCreneauOpen = true
    },
    eventResizeOrDrag(info) {
      this.creneauStore.editCreneau(info.event)
    },
  },
}
</script>

<style lang="scss">
// TODROP
.border-3 {
  border-width: 3px;
}
.text-2xs {
  font-size: 8px;
}
// END-TODROP
.fc {
  .fc-scrollgrid {
    @apply border-none;
    border: none !important;
  }
  .fc-v-event {
    @apply border-none;
    @apply bg-slate-100;
    @apply rounded-xl;
    box-shadow: 2px 2px 4px 0 rgb(209, 209, 209);
  }

  th[role='presentation'] {
    background-color: transparent !important;
  }

  .fc-col-header-cell-cushion {
    color: black !important;
    text-transform: capitalize;
  }

  .fc-scrollgrid-sync-inner {
    @apply text-sm;
  }
}
.fc-direction-ltr .fc-timegrid-col-events {
  margin: 0;
}
</style>
